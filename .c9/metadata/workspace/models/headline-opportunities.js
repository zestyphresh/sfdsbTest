{"filter":false,"title":"headline-opportunities.js","tooltip":"/models/headline-opportunities.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":30},"end":{"row":203,"column":31}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":31},"end":{"row":203,"column":32}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":32},"end":{"row":203,"column":33}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":33},"end":{"row":203,"column":34}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":34},"end":{"row":203,"column":62}},"text":"_dataTransformToMonthlySales"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":62},"end":{"row":203,"column":63}},"text":"'"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":203,"column":63},"end":{"row":203,"column":64}},"text":","}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":229,"column":12},"end":{"row":229,"column":35}},"text":"console.log(newData);  "},{"action":"insertText","range":{"start":{"row":229,"column":12},"end":{"row":229,"column":73}},"text":"console.log('Function:_dataTransformToMonthlySales',newData);"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":229,"column":34},"end":{"row":229,"column":62}},"text":"_dataTransformToMonthlySales"},{"action":"insertText","range":{"start":{"row":229,"column":34},"end":{"row":229,"column":58}},"text":"_dataTransformToTimeline"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":191,"column":24},"end":{"row":191,"column":25}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":191,"column":25},"end":{"row":191,"column":26}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":191,"column":26},"end":{"row":191,"column":27}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":191,"column":27},"end":{"row":191,"column":28}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":192,"column":24},"end":{"row":192,"column":28}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":193,"column":24},"end":{"row":193,"column":28}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":169,"column":0},"end":{"row":169,"column":9}},"text":"        }"},{"action":"removeLines","range":{"start":{"row":90,"column":0},"end":{"row":169,"column":0}},"nl":"\n","lines":["        function _dataTransformToWeeks(originalData) {","            ","            var deliveryWeeks = 4,","                storeWeeks = 4,","                newData = [];","    ","            _(originalData).each(function(d) {","","                var index = _modpriv.datesByDate[d.closeDate].dateIndex;","                ","                var headline = d.recordType === 'Headline' ? true : false;","    ","                var thisWeek = $j.extend({}, d);","                    thisWeek.type = 'Live';","                    newData.push(thisWeek);","                ","                if(d.recordType == 'Headline') {","                    ","                    for (var i = 1; i <= deliveryWeeks; i++) {","                        ","                        var newIndex = index - (i*7);","                        ","                        while (_modpriv.datesByIndex[newIndex].cyWeekNum == 53) {newIndex--;}","","                        var delWeek = $j.extend({}, d);","                            delWeek.week = _modpriv.datesByIndex[newIndex].fyYearWeek;","                            delWeek.month = _modpriv.datesByIndex[newIndex].fyYearMonth;","                            delWeek.closeDate = _modpriv.datesByIndex[newIndex].cyDate;","                            delWeek.weeklyValue = 0;","                            delWeek.type = 'Delivery';","                        newData.push(delWeek);","                ","                    }","    ","                    for (var i = 1; i <= storeWeeks; i++) {","                        ","                        while (_modpriv.datesByIndex[newIndex].cyWeekNum == 53) {newIndex++;}","                        ","                        var newIndex = index + (i*7);","","                        var storeWeek = $j.extend({}, d);","                            storeWeek.week = _modpriv.datesByIndex[newIndex].fyYearWeek;","                            storeWeek.month = _modpriv.datesByIndex[newIndex].fyYearMonth;","                            storeWeek.closeDate = _modpriv.datesByIndex[newIndex].cyDate;","                            storeWeek.type = 'In Store';","                        newData.push(storeWeek);","                    ","                    }","                ","                }","                ","                if (!d.isPromotion) {","                ","                    var maxIndex = 1826; ","                    var add = headline ? storeWeeks * 7 : 0;","                    var start = index + add;","                    var remainingWeeks = Math.floor((maxIndex - start) / 7);","","                    for (var i = 1; i <= remainingWeeks; i++) {","                        ","                        var newIndex = start + (i*7);","                        ","                        while (_modpriv.datesByIndex[newIndex].cyWeekNum == 53) {newIndex++;}","                    ","                        var saleWeek = $j.extend({}, d);","                            saleWeek.week = _modpriv.datesByIndex[newIndex].fyYearWeek;","                            saleWeek.month = _modpriv.datesByIndex[newIndex].fyYearMonth;","                            saleWeek.closeDate = _modpriv.datesByIndex[newIndex].cyDate;","                            saleWeek.type = headline ? 'Sales' : 'Loss';","                        newData.push(saleWeek);","                    ","                    }","                ","                }","                ","            });","                ","            return newData;","            "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":91,"column":0},"end":{"row":91,"column":8}},"text":"        "},{"action":"removeLines","range":{"start":{"row":90,"column":0},"end":{"row":91,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":89,"column":0},"end":{"row":89,"column":93}},"text":"        //TODO - Not adding records correctly by week plus need way to push week 53 to week 1"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":89,"column":0},"end":{"row":90,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":89,"column":0},"end":{"row":90,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":101,"column":44},"end":{"row":102,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":102,"column":0},"end":{"row":102,"column":20}},"text":"                    "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":102,"column":16},"end":{"row":102,"column":20}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":102,"column":16},"end":{"row":103,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":103,"column":0},"end":{"row":103,"column":16}},"text":"                "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":16},"end":{"row":103,"column":17}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":17},"end":{"row":103,"column":18}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":18},"end":{"row":103,"column":19}},"text":"w"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":19},"end":{"row":103,"column":20}},"text":"D"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":20},"end":{"row":103,"column":21}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":21},"end":{"row":103,"column":22}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":22},"end":{"row":103,"column":23}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":23},"end":{"row":103,"column":24}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":24},"end":{"row":103,"column":25}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":25},"end":{"row":103,"column":26}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":26},"end":{"row":103,"column":27}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":27},"end":{"row":103,"column":28}},"text":"h"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":28},"end":{"row":103,"column":30}},"text":"()"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":29},"end":{"row":103,"column":31}},"text":"{}"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":30},"end":{"row":103,"column":32}},"text":"''"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":31},"end":{"row":103,"column":32}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":32},"end":{"row":103,"column":33}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":33},"end":{"row":103,"column":34}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":34},"end":{"row":103,"column":35}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":36},"end":{"row":103,"column":37}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":37},"end":{"row":103,"column":38}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":38},"end":{"row":103,"column":39}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":39},"end":{"row":103,"column":64}},"text":"d.mDate.format('YYYY-MM')"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":64},"end":{"row":103,"column":65}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":65},"end":{"row":103,"column":66}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":66},"end":{"row":103,"column":68}},"text":"''"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":67},"end":{"row":103,"column":68}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":68},"end":{"row":103,"column":69}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":69},"end":{"row":103,"column":70}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":70},"end":{"row":103,"column":71}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":71},"end":{"row":103,"column":72}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":73},"end":{"row":103,"column":74}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":74},"end":{"row":103,"column":75}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":75},"end":{"row":103,"column":76}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":76},"end":{"row":103,"column":119}},"text":"headline? d.isoValue : d.annualisedValue/12"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":103,"column":76},"end":{"row":103,"column":119}},"text":"headline? d.isoValue : d.annualisedValue/12"},{"action":"insertText","range":{"start":{"row":103,"column":76},"end":{"row":103,"column":77}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":77},"end":{"row":103,"column":78}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":78},"end":{"row":103,"column":79}},"text":"l"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":79},"end":{"row":103,"column":80}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":103,"column":80},"end":{"row":103,"column":81}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":99,"column":16},"end":{"row":99,"column":29}},"text":"    thisMonth"},{"action":"insertText","range":{"start":{"row":99,"column":16},"end":{"row":99,"column":17}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":99,"column":17},"end":{"row":99,"column":18}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":99,"column":18},"end":{"row":99,"column":19}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":99,"column":19},"end":{"row":99,"column":20}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":99,"column":19},"end":{"row":99,"column":20}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":98,"column":0},"end":{"row":98,"column":49}},"text":"                var thisMonth = $j.extend({}, d);"},{"action":"removeLines","range":{"start":{"row":97,"column":0},"end":{"row":98,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":100,"column":0},"end":{"row":100,"column":44}},"text":"                    newData.push(thisMonth);"},{"action":"removeLines","range":{"start":{"row":99,"column":0},"end":{"row":100,"column":0}},"nl":"\n","lines":["                    thisMonth.date = d.mDate.format('YYYY-MM');"]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":100,"column":0},"end":{"row":100,"column":16}},"text":"                "},{"action":"removeLines","range":{"start":{"row":99,"column":0},"end":{"row":100,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":81},"end":{"row":100,"column":82}},"text":","}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":82},"end":{"row":100,"column":83}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":83},"end":{"row":100,"column":85}},"text":"''"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":84},"end":{"row":100,"column":85}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":85},"end":{"row":100,"column":86}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":86},"end":{"row":100,"column":87}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":87},"end":{"row":100,"column":88}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":88},"end":{"row":100,"column":89}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":89},"end":{"row":100,"column":90}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":100,"column":84},"end":{"row":100,"column":90}},"text":"record"},{"action":"insertText","range":{"start":{"row":100,"column":84},"end":{"row":100,"column":94}},"text":"recordType"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":95},"end":{"row":100,"column":96}},"text":":"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":95},"end":{"row":100,"column":96}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":97},"end":{"row":100,"column":98}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":98},"end":{"row":100,"column":99}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":99},"end":{"row":100,"column":100}},"text":"."}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":100},"end":{"row":100,"column":101}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":101},"end":{"row":100,"column":102}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":102},"end":{"row":100,"column":103}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":103},"end":{"row":100,"column":104}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":104},"end":{"row":100,"column":105}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":105},"end":{"row":100,"column":106}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":106},"end":{"row":100,"column":107}},"text":"T"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":107},"end":{"row":100,"column":108}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":108},"end":{"row":100,"column":109}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":100,"column":109},"end":{"row":100,"column":110}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":111,"column":24},"end":{"row":111,"column":48}},"text":"newData.push(thisMonth);"},{"action":"insertText","range":{"start":{"row":111,"column":24},"end":{"row":111,"column":120}},"text":"newData.push({'date' : d.mDate.format('YYYY-MM'), 'value' : value, 'recordType' : d.recordType})"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":111,"column":84},"end":{"row":111,"column":89}},"text":"value"},{"action":"insertText","range":{"start":{"row":111,"column":84},"end":{"row":111,"column":104}},"text":"d.annualisedValue/12"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":110,"column":0},"end":{"row":110,"column":71}},"text":"                            thisMonth.date = d.mDate.format('YYYY-MM');"},{"action":"removeLines","range":{"start":{"row":107,"column":0},"end":{"row":110,"column":0}},"nl":"\n","lines":["                        ","                        var thisMonth = $j.extend({}, d);","                            thisMonth.value = d.annualisedValue/12;"]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":107,"column":0},"end":{"row":108,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":107,"column":0},"end":{"row":108,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":110,"column":24},"end":{"row":110,"column":49}},"text":"d.mDate.add('months', 1);"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":106,"column":47},"end":{"row":107,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":107,"column":0},"end":{"row":107,"column":24}},"text":"                        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":107,"column":24},"end":{"row":108,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":108,"column":0},"end":{"row":108,"column":24}},"text":"                        "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":108,"column":24},"end":{"row":108,"column":49}},"text":"d.mDate.add('months', 1);"}]}]]},"ace":{"folds":[],"scrolltop":1351.4996337890625,"scrollleft":0,"selection":{"start":{"row":97,"column":0},"end":{"row":97,"column":0},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":89,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1407928139821,"hash":"d3dabad02219a0bc625a6ef4db2c859ea7c7bdb3"}