{"filter":false,"title":"epos.js","tooltip":"/models/epos.js","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":22},"end":{"row":76,"column":23}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":22},"end":{"row":76,"column":23}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":75,"column":19},"end":{"row":75,"column":36}},"text":"accountParentName"},{"action":"insertText","range":{"start":{"row":75,"column":19},"end":{"row":75,"column":20}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":20},"end":{"row":75,"column":21}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":21},"end":{"row":75,"column":22}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":22},"end":{"row":75,"column":23}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":23},"end":{"row":75,"column":24}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":24},"end":{"row":75,"column":25}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":25},"end":{"row":75,"column":26}},"text":"A"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":26},"end":{"row":75,"column":27}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":27},"end":{"row":75,"column":28}},"text":"c"},{"action":"insertText","range":{"start":{"row":75,"column":28},"end":{"row":75,"column":29}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":29},"end":{"row":75,"column":30}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":30},"end":{"row":75,"column":31}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":31},"end":{"row":75,"column":32}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":32},"end":{"row":75,"column":33}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":75,"column":41},"end":{"row":75,"column":46}},"text":"owner"},{"action":"insertText","range":{"start":{"row":75,"column":41},"end":{"row":75,"column":42}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":42},"end":{"row":75,"column":43}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":43},"end":{"row":75,"column":44}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":44},"end":{"row":75,"column":45}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":45},"end":{"row":75,"column":46}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":46},"end":{"row":75,"column":47}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":47},"end":{"row":75,"column":48}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":48},"end":{"row":75,"column":49}},"text":"P"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":49},"end":{"row":75,"column":50}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":50},"end":{"row":75,"column":51}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":51},"end":{"row":75,"column":52}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":52},"end":{"row":75,"column":53}},"text":"n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":53},"end":{"row":75,"column":54}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":54},"end":{"row":75,"column":55}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":55},"end":{"row":75,"column":56}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":56},"end":{"row":75,"column":57}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":75,"column":57},"end":{"row":75,"column":58}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":37},"end":{"row":76,"column":38}},"text":"s"},{"action":"insertText","range":{"start":{"row":76,"column":38},"end":{"row":76,"column":39}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":39},"end":{"row":76,"column":40}},"text":"b"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":40},"end":{"row":76,"column":41}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":40},"end":{"row":76,"column":41}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":76,"column":55},"end":{"row":77,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":77,"column":0},"end":{"row":77,"column":12}},"text":"            "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":12},"end":{"row":77,"column":55}},"text":"groups.subSectors = dims.subSector.group();"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":19},"end":{"row":77,"column":22}},"text":"sub"},{"action":"removeText","range":{"start":{"row":77,"column":19},"end":{"row":77,"column":20}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":19},"end":{"row":77,"column":20}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":34},"end":{"row":77,"column":38}},"text":"subS"},{"action":"insertText","range":{"start":{"row":77,"column":34},"end":{"row":77,"column":35}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":77,"column":49},"end":{"row":78,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":78,"column":0},"end":{"row":78,"column":12}},"text":"            "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":12},"end":{"row":78,"column":49}},"text":"groups.sectors = dims.sector.group();"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":78,"column":19},"end":{"row":78,"column":26}},"text":"sectors"},{"action":"insertText","range":{"start":{"row":78,"column":19},"end":{"row":78,"column":20}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":20},"end":{"row":78,"column":21}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":21},"end":{"row":78,"column":22}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":22},"end":{"row":78,"column":23}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":23},"end":{"row":78,"column":24}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":24},"end":{"row":78,"column":25}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":25},"end":{"row":78,"column":26}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":26},"end":{"row":78,"column":27}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":78,"column":35},"end":{"row":78,"column":41}},"text":"sector"},{"action":"insertText","range":{"start":{"row":78,"column":35},"end":{"row":78,"column":36}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":36},"end":{"row":78,"column":37}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":37},"end":{"row":78,"column":38}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":38},"end":{"row":78,"column":39}},"text":"d"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":39},"end":{"row":78,"column":40}},"text":"u"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":40},"end":{"row":78,"column":41}},"text":"c"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":41},"end":{"row":78,"column":42}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":42},"end":{"row":78,"column":43}},"text":"N"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":43},"end":{"row":78,"column":44}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":44},"end":{"row":78,"column":45}},"text":"m"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":45},"end":{"row":78,"column":46}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":55},"end":{"row":79,"column":0}},"text":"\n"},{"action":"insertText","range":{"start":{"row":79,"column":0},"end":{"row":79,"column":12}},"text":"            "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":12},"end":{"row":79,"column":55}},"text":"groups.products = dims.productName.group();"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":91,"column":0},"end":{"row":91,"column":35}},"text":"            toTimeline : toTimeline"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":90,"column":26},"end":{"row":91,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":26},"end":{"row":79,"column":27}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":26},"end":{"row":79,"column":27}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":27},"end":{"row":79,"column":28}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":28},"end":{"row":79,"column":29}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":29},"end":{"row":79,"column":30}},"text":"e"},{"action":"insertText","range":{"start":{"row":79,"column":30},"end":{"row":79,"column":31}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":31},"end":{"row":79,"column":32}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":32},"end":{"row":79,"column":33}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":33},"end":{"row":79,"column":34}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":34},"end":{"row":79,"column":35}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":35},"end":{"row":79,"column":36}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":79,"column":51},"end":{"row":79,"column":55}},"text":"Name"},{"action":"insertText","range":{"start":{"row":79,"column":51},"end":{"row":79,"column":52}},"text":"C"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":52},"end":{"row":79,"column":53}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":53},"end":{"row":79,"column":54}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":54},"end":{"row":79,"column":55}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":55},"end":{"row":79,"column":56}},"text":"g"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":56},"end":{"row":79,"column":57}},"text":"o"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":57},"end":{"row":79,"column":58}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":79,"column":58},"end":{"row":79,"column":59}},"text":"y"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":80,"column":0},"end":{"row":80,"column":12}},"text":"            "},{"action":"removeText","range":{"start":{"row":79,"column":68},"end":{"row":80,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":92,"column":0},"end":{"row":92,"column":38}},"text":"        //CROSSFILTER REDUCE FUNCTIONS"},{"action":"removeLines","range":{"start":{"row":92,"column":0},"end":{"row":93,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":92,"column":0},"end":{"row":93,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":185,"column":0},"end":{"row":185,"column":4}},"text":"    "},{"action":"removeLines","range":{"start":{"row":94,"column":0},"end":{"row":185,"column":0}},"nl":"\n","lines":["        //_dataTransformToMonthlySales","        //_dataTransformToTimeline","        ","        function _convertThreatsToNegative(data) {","","            return _.each(_.cloneDeep(data), function(v) {","                if (v.recordType === 'Threat') {","                    v.isoValue = -v.isoValue;","                    v.isoValuePrevious = -v.isoValuePrevious;","                    v.annualisedValue = -v.annualisedValue;","                    v.annualisedValuePrevious = -v.annualisedValuePrevious;","                    v.weeklyValue = -v.weeklyValue;","                    v.weeklyValuePrevious = -v.weeklyValuePrevious;","                    v.thisYearValue = -v.thisYearValue;","                    v.thisYearValuePrevious = -v.thisYearValuePrevious;","                }","            });","            ","        }","    ","        function _dataTransformToMonthlySales(originalData) {","            ","            var maxDate = new moment('2015-12-31', 'YYYY-MM-DD');","            var newData = [];","    ","            _(originalData).each(function(d) {","","                var headline = d.recordType === 'Headline' ? true : false;","","                var value = headline? d.isoValue : d.annualisedValue/12;","","                newData.push({'date' : d.mDate.format('YYYY-MM'), 'value' : value, 'recordType' : d.recordType});","                ","                d.mDate.add('months', 1);    ","                    ","                if (!d.isPromotion) {","","                    while (d.mDate < maxDate) {","","                        newData.push({'date' : d.mDate.format('YYYY-MM'), 'value' : d.annualisedValue/12, 'recordType' : d.recordType});","                        ","                        d.mDate.add('months', 1);","                        ","                    }","                    ","                }","                    ","            });","            ","            //console.log('Function:_dataTransformToMonthlySales',newData);","                    ","            return newData;","            ","        }","        ","        ","        function toTimeline(originalData) {","            ","            var newData = [];","                ","            _(originalData).each(function(d) {","                ","                var headline = d.recordType === 'Headline' ? true : false;","                ","                if (d.stageCategory === 'Confirmed'){","                ","                    var deliveryDate = d.closeDate.clone().subtract('weeks', 4),","                        storeDate = d.closeDate.clone().add('weeks', 4),","                        maxDate = new moment('2015-12-31', 'YYYY-MM-DD'),","                        tClass = headline ? 'headline' : 'threat',","                        content = d.account + ' - ' + d.name + '</br>' + ","                                  'ISO - ' + f.toGbp(d.isoValue) + ', Annualised - ' + f.toGbp(d.annualisedValue);","                        var group;","                        ","                        if (d.isoValue + d.annualisedValue < 50000) {","                            group = 'Low Value';","                        } else if (d.isoValue + d.annualisedValue < 250000) {","                            group = 'Medium Value';","                        } else {","                            group = 'High Value';","                        }","                        ","                    newData.push({'group' : group, 'start' : deliveryDate.toDate(), 'end' : storeDate.toDate(), 'content' : content, 'className' : tClass});","                ","                }","                ","            });","            ","            return _(newData).sortBy('start').reverse().value();","            ","        }"]},{"action":"removeText","range":{"start":{"row":93,"column":7},"end":{"row":93,"column":35}},"text":" //_convertThreatsToNegative"},{"action":"removeText","range":{"start":{"row":93,"column":7},"end":{"row":94,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":0,"column":10},"end":{"row":0,"column":23}},"text":"OPPORTUNITIES"},{"action":"insertText","range":{"start":{"row":0,"column":10},"end":{"row":0,"column":11}},"text":"E"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":11},"end":{"row":0,"column":12}},"text":"P"},{"action":"insertText","range":{"start":{"row":0,"column":12},"end":{"row":0,"column":13}},"text":"O"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":13},"end":{"row":0,"column":14}},"text":"S"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":75,"column":32},"end":{"row":75,"column":33}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":28},"end":{"row":76,"column":29}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":25},"end":{"row":77,"column":26}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":0},"end":{"row":77,"column":48}},"text":"            groups.sector = dims.sector.group();"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":76,"column":54},"end":{"row":77,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":77,"column":26},"end":{"row":77,"column":27}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":78,"column":34},"end":{"row":78,"column":35}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":78,"column":33},"end":{"row":78,"column":34}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":78,"column":33},"end":{"row":78,"column":34}},"text":"s"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":78,"column":33},"end":{"row":78,"column":34}},"text":"y"}]}]]},"ace":{"folds":[],"scrolltop":780,"scrollleft":0,"selection":{"start":{"row":71,"column":8},"end":{"row":71,"column":8},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1409658941737,"hash":"002959ba9cdb98ac7e4f396bc2edf93a68d9f75b"}